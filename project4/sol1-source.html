<!DOCTYPE html>
<html>
  <head>
    <title>Dogs</title>
    <meta name="viewport" content="width=device-width, initialscale=1">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
        $(document).bind('mobileinit',function(){
            $.mobile.changePage.defaults.changeHash = false;
            $.mobile.hashListeningEnabled = false;
            $.mobile.pushStateEnabled = false;
        });
    </script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCH5B8z04TLcdPiUf2XimlIZv99lY3o8TA"></script>
  </head>
  <body>
    <div data-role="page" id="dogs">
      <div data-role="header">
        <h1>OU Places</h1>
      </div>
      <div data-role="content">
        <div id="map"  style="width: 100%;height:300px; margin: 0;"></div>
        <div id="content"></div>
      </div>
      <div data-role="footer">
        
        <h4 id="test">&copy; Nobody</h4>
      </div>
    </div>

    <script>
      "use strict";
      /**
       * One location on campus. A rectangle defined by NW lat long, and
       * SE lat long
       * @param {number} northWestLat Lat of NW corner.
       * @param {number} northWestLong Long of NW corner.
       * @param {number} southEastLat Lat of SE corner.
       * @param {number} southEastLong Long of SE corner.
       * @param {string} content HTML Content about location.
       * @returns {Location} Location object.
       */
      var Location = function (
              northWestLat,
              northWestLong,
              southEastLat,
              southEastLong,
              content) {
        this.northWestLat = northWestLat,
                this.northWestLong = northWestLong,
                this.southEastLat = southEastLat,
                this.southEastLong = southEastLong,
                this.content = content
      }

      Location.prototype.render = function () {
          $("#content").html( this.content );

      };

      /**
       * Locations this page knows about.
       * @type Array of Locations.
       */
      var locations = [
        new Location(
                42.672466, -83.214408, //nw
                42.671746, -83.213116, //se
                "<h1>Elliot Hall</h1>" +
                "<p>Bad place</p>"
                ), //42.672, -83.214,
        new Location (
                42.674719, -83.213947,
                42.673065, -83.212150,
                "<h1>Rec Center</h1>" +
                "<p>Exercise and other bad things.</p>"
                ),
        new Location(
                42.69, -83.191,
                42.666, -83.195,
                "<h1>Kieran's house</h1>" +
                "<p>Doom and gloom</p>"
                )
      ];

      var timerInvervalMsecs = 10000;
      var testIt = false;
      var timeoutId;
      $(document).ready(function () {
        if (!navigator.geolocation) {
          $("#map").html("<p>Sorry, can't show your location.</p>");
          return;
        }
        controller();
        $("#test").click(function() {
          testIt = true;
          controller();
        });
      });
      var controller = function () {
        //Clear timer, necessary when testing.
        window.clearTimeout( timeoutId );
        navigator.geolocation.getCurrentPosition(function (position) {
          //Get current location.
          var lat, long;
          if ( testIt ) {
            lat = prompt("Lat?");
            long = prompt("Long?");
            testIt = false;
          }
          else {
            lat = position.coords.latitude;
            long = position.coords.longitude;
          }
          var currentLatLng = new google.maps.LatLng( lat, long );
          //Draw map and marker for current location.
          var mapOptions = {
            center: currentLatLng,
            zoom: 18,
            mapTypeId: google.maps.MapTypeId.SATELLITE
          };
          var map = new google.maps.Map(document.getElementById("map"), mapOptions);
          var marker = new google.maps.Marker({
            position: currentLatLng,
            map: map,
            title: "<div style = 'height:60px;width:200px'><b>Your location:</b><br />Latitude: " + position.coords.latitude + "<br />Longitude: " + position.coords.longitude
          });
          //Check whether in a known location.
          locations.forEach(function (location) {
            if (inLocation(currentLatLng, location)) {
              location.render();
            }
          });
        }); //End getCurrentPosition.
        //Start timer for next update.
        timeoutId = window.setTimeout(controller, timerInvervalMsecs);
      };
      
      function inLocation( currentLatLng, location ) {
        return    currentLatLng.lat() <= location.northWestLat
               && currentLatLng.lng() >= location.northWestLong
               && currentLatLng.lat() >= location.southEastLat
               && currentLatLng.lng() <= location.southEastLong;
      }



    </script>

  </body>
</html>